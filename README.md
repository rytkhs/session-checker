# セッション有効性チェックツール

このスクリプトは、特定のウェブサイトにログインした後、そのセッションがどの程度の期間有効であるかを自動的にチェックするためのツールです。
Seleniumを使用してブラウザを操作し、CookieとLocalStorage/SessionStorageを保存・復元することで、手動ログイン後のセッション維持状態を監視します。

## 機能

- 手動ログイン後のセッション情報の保存
- Cookie、LocalStorage、SessionStorage の保持と再利用
- 定期的なセッション有効性チェック
- 詳細なログ出力（ファイルおよびコンソール）
- 自動再接続機能

## 必要要件

- Python 3.8 以上
- Google Chrome
- ChromeDriver（Chrome のバージョンに対応したもの）

## インストール

1. 必要なパッケージをインストール：

```bash
pip install selenium python-dotenv
```

2. `.env.example`を`.env`にコピーして設定を変更：

```bash
copy .env.example .env
```

## 環境変数の設定

`.env`ファイルで以下の設定が可能です：

- `INITIAL_URL`: チェック対象の URL (マイページやダッシュボードなどログインが必要なページを指定)
- `MANUAL_LOGIN_WAIT_SECONDS`: 手動ログインの待機時間（秒）
- `POST_ACCESS_WAIT_SECONDS`: アクセス後の待機時間（秒）
- `INITIAL_WAIT_TIME`: 初回チェックまでの待機時間（分）
- `WAIT_TIME_INCREMENT`: チェック間隔の増分（分）。各ループごとにこの値だけ待機時間が増加
- `USER_AGENT`: 使用するユーザーエージェント
- `COOKIES_FILE`: Cookie 保存用ファイル名
- `SESSION_FILE`: セッション情報保存用ファイル名
- `CHROME_PROFILE_DIR`: Chrome 設定保存用ディレクトリ

## 使用方法

1. 環境変数を設定
2. スクリプトを実行：

```bash
python session_checker.py
```

3. ブラウザが起動したら手動でログイン
4. ログイン完了後、スクリプトが自動的にセッションの監視を開始

## 動作の流れ

1. 初回実行時：

   - ブラウザを起動し、指定された URL にアクセス
   - ユーザーによる手動ログインを待機
   - ログイン成功後、セッション情報を保存

2. 2 回目以降：
   - 保存されたセッション情報を使用して自動的に再接続
   - 定期的にセッションの有効性をチェック
   - セッションが無効になった場合は通知して終了

## 生成されるファイル

スクリプトを実行すると、以下のファイルやディレクトリが（`.env` の設定に応じて）生成されることがあります。

-   `session_check.log`: スクリプトの動作ログが記録されるファイル
-   `saved_cookies.json` (デフォルト名): ログインセッションのCookie情報がJSON形式で保存されるファイル
-   `selenium_session.pkl` (デフォルト名): LocalStorageとSessionStorageのデータがpickle形式で保存されるファイル
-   `chrome_profile/` (デフォルト名): Seleniumが使用するChromeのユーザープロファイルが保存されるディレクトリ

## 注意事項

- このスクリプトは教育的目的または個人的な分析のために提供されています。対象ウェブサイトの利用規約を遵守し、迷惑をかけない範囲で使用してください。
- ウェブサイト側のセキュリティ対策（IPアドレスの変動チェック、CAPTCHA、より高度なボット検出など）によっては、このスクリプトが期待通りに動作しない場合があります。
- 初回ログイン時は手動での操作が必要です
